# 01 要件と設計

予約アプリの目的・機能・構成・画面遷移・データ設計をまとめたドキュメントです。

---

## 1. 目的・想定ユーザー

- **目的**: 大病院の診療予約を Web（スマホ）から簡単に行えるようにする。電話・窓口の負担を減らす。
- **想定ユーザー**: スマホを利用する患者（20代〜高齢者）。ITリテラシーは高くない人も含む → **直感的で分かりやすいUIが必須**。
- **利用環境**: スマホ優先・PC補助、Chrome/Safari、Webアプリ（インストール不要）。

---

## 2. 必須機能

| 機能 | 内容 |
|------|------|
| **ユーザー登録・ログイン** | メール+パスワード、Firebase Authentication。ログイン状態はリロード後も保持。 |
| **日付選択カレンダー** | 月表示、過去日は選択不可、選択日に応じて予約枠を表示。 |
| **予約登録** | 大分類 → 診療科 → 予約目的 → 担当医（任意）→ 30分刻み時間。Firestore に保存。同一時間帯の重複は不可。 |

**画面**: ログイン / 新規登録 / メニュー / カレンダー / 予約入力フォーム / 予約確認・完了 / 予約一覧（変更・キャンセル）。

**非機能**: 3〜5タップで予約完了、スマホで文字が小さくなりすぎない、エラー時は分かりやすいメッセージ。

---

## 3. ディレクトリ構成

```
backend/                 # FastAPI（IDトークン検証・ユーザー同期）
├── main.py, firebase_admin_client.py, models.py, store.py, requirements.txt

frontend/src/
├── pages/       LoginPage, SignupPage, MenuPage, CalendarPage, ReserveFormPage, ReserveConfirmPage, MyReservationsPage
├── components/  Calendar, InputForm, TimeSlot
├── services/    auth, backend, reservation, availability, doctors, user
├── firebase/    Firebase設定
├── constants/   マスタデータ（大分類・診療科・目的・担当医・時間枠）
├── utils/
├── App.jsx      ルーティング・認証状態
└── main.jsx
```

---

## 4. 画面遷移

| 遷移 | 備考 |
|------|------|
| `/login` → ログイン成功 → `/menu` | メニュー（ご用件を選択） |
| `/signup` → 登録成功 → `/calendar` | 実装は SignupPage で /calendar に遷移 |
| `/menu` → 「予約する」→ `/calendar` → 日付選択 → `/reserve/form` | state で日付を渡す |
| `/reserve/form` → 入力完了 → `/reserve/confirm` | state で入力内容を渡す |
| `/reserve/confirm` → 確定 → Firestore 保存 → 完了表示 | |
| `/menu` → 「予約を確認する」→ `/reservations` | MyReservationsPage |

未ログインで `/menu`・`/calendar`・`/reserve/*`・`/reservations` にアクセスした場合は `/login` へリダイレクト。

---

## 5. データ設計（Firestore）

- **予約**: `users/{uid}/reservations/{reservationId}`  
  - フィールド: date（YYYY-MM-DD）, time（例 09:00）, category, department, purpose, doctor, createdAt  
  - 同一ユーザーで同一 date+time の重複は不可（reservation.js でチェック）
- **認証**: Firebase Authentication に一本化。バックエンドは IDトークン検証で `/users/me` で uid/email を返す。store.py はメモリDB（再起動でリセット、学習用）。

---

## 6. 技術選定

| 区分 | 技術 |
|------|------|
| フロント | React + Vite + react-router-dom、スマホ前提の独自CSS（フォント 16px 以上） |
| バックエンド | FastAPI + firebase-admin（IDトークン検証） |
| 認証・DB | Firebase Authentication / Firestore |
